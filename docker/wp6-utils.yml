version: '3.7'

services:

  sampling:
    image: ocni/hpc_sampler:latest
    secrets:
      - db_ait

  filebeat:
    image: filebeat
    environment:
      - logstash_host=$LH
    volumes:
      - /var/lib/docker/containers:/usr/share/dockerlogs/data:ro
      - /var/run/docker.sock:/var/run/docker.sock

  checker:
    image: ocni/hpc_checker:latest
    secrets:
      - ssh_key
      - hpc_ocni

  check_sim:
    image: ocni/hpc_check_sim:latest
    secrets:
      - db_ait

secrets:
  ssh_key:
    file: /home/ocni/.ssh/id_rsa
  db_ait:
    file: /home/ocni/.ssh/db_ait.json
  db_simon:
    file: /home/ocni/.ssh/db_simon.json
  hpc_ocni:
    file: /home/ocni/.ssh/hpc_ocni.json
